generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Tamanho {
  PEQUENO
  MEDIO
  GRANDE
  GIGANTE
}

enum Temperamento {
  DOCIL
  BRINCALHAO
  TIMIDO
  AGITADO
  AGRESSIVO
  CALMO
}

enum StatusHospedagem {
  ATIVO
  CHECKOUT
}

enum StatusCreche {
  AGENDADO
  FINALIZADO
}

enum StatusCobranca {
  PENDENTE
  PAGO
}

model Cliente {
  id            Int            @id @default(autoincrement())
  nome          String
  email         String?        @unique
  telefone      String
  cpf           String?        @unique
  endereco      String?
  emergencia    String?
  dataCadastro  DateTime       @default(now())

  pets          Pet[]
  mensagens     Mensagem[]
  avaliacoes    Avaliacao[]
  cobrancas     Inadimplencia[]
}

model Pet {
  id                 Int            @id @default(autoincrement())
  clienteId          Int
  cliente            Cliente        @relation(fields: [clienteId], references: [id], onDelete: Cascade)

  nome               String
  especie            String
  raca               String
  tamanho            Tamanho
  peso               Float?
  idade              String?
  temperamento       Temperamento
  castrado           String?
  medicamentos       String?
  cartaoVacinaNumero String
  observacoes        String?
  dataCadastro       DateTime       @default(now())

  hospedagens        Hospedagem[]
  creches            Creche[]
  mensagens          Mensagem[]
  avaliacoes         Avaliacao[]
  imagens            PetImagem[]
}

model Hospedagem {
  id              Int              @id @default(autoincrement())
  petId           Int
  pet             Pet              @relation(fields: [petId], references: [id], onDelete: Cascade)

  clienteNome     String
  petNome         String
  checkin         DateTime
  checkout        DateTime
  dias            Int
  servicos        String?
  subtotal        Float
  descontoPercent Float            @default(0)
  total           Float
  plano           String
  status          StatusHospedagem @default(ATIVO)
  dataCriacao     DateTime         @default(now())
}

model Creche {
  id              Int           @id @default(autoincrement())
  petId           Int
  pet             Pet           @relation(fields: [petId], references: [id], onDelete: Cascade)

  clienteNome     String
  petNome         String
  data            DateTime
  periodo         String         // "Meio período" ou "Integral"
  plano           String
  entrada         String?
  saida           String?
  dias            Int
  atividades      String?
  subtotal        Float
  descontoPercent Float          @default(0)
  total           Float
  status          StatusCreche   @default(AGENDADO)
  dataCriacao     DateTime       @default(now())
}

model Mensagem {
  id          Int       @id @default(autoincrement())
  clienteId   Int
  cliente     Cliente   @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  petId       Int?
  pet         Pet?      @relation(fields: [petId], references: [id])

  tipo        String     // Check-in | Check-out | Lembrete | Satisfação
  mensagem    String
  status      String     // Enviada | Falhou, etc.
  dataHora    DateTime   @default(now())
}

model Avaliacao {
  id          Int       @id @default(autoincrement())
  clienteId   Int
  cliente     Cliente   @relation(fields: [clienteId], references: [id], onDelete: Cascade)
  petId       Int
  pet         Pet       @relation(fields: [petId], references: [id], onDelete: Cascade)

  servico     String    // Hospedagem | Creche
  nota        Int
  comentario  String?
  data        DateTime  @default(now())
}

model Inadimplencia {
  id            Int            @id @default(autoincrement())
  clienteId     Int
  cliente       Cliente        @relation(fields: [clienteId], references: [id], onDelete: Cascade)

  valor         Float
  vencimento    DateTime
  diasAtraso    Int
  descricao     String
  status        StatusCobranca @default(PENDENTE)
  dataCriacao   DateTime       @default(now())
  dataPagamento DateTime?
}

model ConfiguracaoComunicacao {
  id              Int      @id @default(autoincrement())
  whatsappToken   String?
  whatsappNumero  String?
  smsApiKey       String?
  msgCheckin      String?
  msgCheckout     String?
  msgLembrete     String?
  msgSatisfacao   String?
  dataAtualizacao DateTime @default(now()) @updatedAt
}

model PetImagem {
  id        Int      @id @default(autoincrement())
  petId     Int
  pet       Pet      @relation(fields: [petId], references: [id], onDelete: Cascade)
  
  nome      String
  src       String   @db.Text // Base64 da imagem
  tipo      String?  // "galeria" ou "cartao_vacina"
  timestamp DateTime @default(now())
}

model PlanoCustomizado {
  id              Int      @id @default(autoincrement())
  nome            String
  meses           Int
  diasMes         Int
  descontoPercent Float
  aplica          String   // "hospedagem", "creche", "ambos"
  ativo           Boolean  @default(true)
  dataCriacao     DateTime @default(now())
}

model Configuracao {
  id                        Int      @id @default(autoincrement())
  // Preços Hospedagem
  precoHospedagemPequeno    Float    @default(80)
  precoHospedagemMedio      Float    @default(100)
  precoHospedagemGrande     Float    @default(120)
  precoHospedagemGigante    Float    @default(150)
  
  // Preços Creche Meio Período
  precoCrecheMeioPequeno    Float    @default(40)
  precoCrecheMeioMedio      Float    @default(50)
  precoCrecheMeioGrande     Float    @default(60)
  precoCrecheMeioGigante    Float    @default(70)
  
  // Preços Creche Integral
  precoCrecheIntegralPequeno Float   @default(65)
  precoCrecheIntegralMedio   Float   @default(80)
  precoCrecheIntegralGrande  Float   @default(95)
  precoCrecheIntegralGigante Float   @default(110)
  
  // Preços Extras
  precoBanho                Float    @default(30)
  precoConsulta             Float    @default(80)
  precoTransporte           Float    @default(20)
  precoAdaptacao            Float    @default(15)
  precoTreinamento          Float    @default(25)
  
  dataAtualizacao           DateTime @default(now()) @updatedAt
}
